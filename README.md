![](img\OpenClaw QQ Plugin.png)


<h1 align="center">OpenClaw QQ Plugin</h1>

<p align="center">
  <strong>è®©ä½ çš„ AI Agent æ¥å…¥ QQ ä¸ªäººå· â€”â€” æ”¯æŒæ–‡å­—ã€å›¾ç‰‡ã€æ–‡ä»¶ã€è¯­éŸ³ã€ä¸»åŠ¨æ¨é€ã€å®šæ—¶ä»»åŠ¡</strong>
</p>

<p align="center">
  <a href="#-å¿«é€Ÿå¼€å§‹">å¿«é€Ÿå¼€å§‹</a> â€¢
  <a href="#-åŠŸèƒ½ç‰¹æ€§">åŠŸèƒ½ç‰¹æ€§</a> â€¢
  <a href="#-æ¶æ„è¯´æ˜">æ¶æ„è¯´æ˜</a> â€¢
  <a href="#-å·¥å…·è„šæœ¬">å·¥å…·è„šæœ¬</a> â€¢
  <a href="#-å¸¸è§é—®é¢˜">FAQ</a> â€¢
  <a href="#english">English</a>
</p>

<p align="center">
  <img src="https://img.shields.io/badge/OpenClaw-Plugin-blue?style=flat-square" alt="OpenClaw Plugin" />
  <img src="https://img.shields.io/badge/Protocol-OneBot_v11-green?style=flat-square" alt="OneBot v11" />
  <img src="https://img.shields.io/badge/Language-TypeScript-blue?style=flat-square" alt="TypeScript" />
  <img src="https://img.shields.io/badge/License-MIT-yellow?style=flat-square" alt="MIT License" />
  <img src="https://img.shields.io/badge/Node.js-22%2B-brightgreen?style=flat-square" alt="Node.js 22+" />
</p>

---

## ç®€ä»‹

è¿™æ˜¯ä¸€ä¸ª [OpenClaw](https://github.com/openclaw/openclaw) çš„ QQ é¢‘é“æ’ä»¶ï¼Œé€šè¿‡ [OneBot v11](https://github.com/botuniverse/onebot-11) åè®®ï¼ˆWebSocketï¼‰æ¥å…¥ QQ ä¸ªäººå·ã€‚

é…åˆ [NapCat](https://github.com/NapCatQQ/NapCat-Docker) ä½¿ç”¨ï¼Œå¯ä»¥è®©ä½ çš„ AI Agent é€šè¿‡ QQ ä¸ä½ å¯¹è¯ï¼Œå¹¶ä¸”æ”¯æŒå‘é€å›¾ç‰‡ã€æ–‡ä»¶ã€è¯­éŸ³ã€è§†é¢‘ç­‰å¤šåª’ä½“æ¶ˆæ¯ï¼Œç”šè‡³å¯ä»¥ä¸»åŠ¨ç»™ä½ å‘æ¶ˆæ¯ã€å®šæ—¶é—®å€™ã€æœåŠ¡å™¨å‘Šè­¦é€šçŸ¥ã€‚

**ä¸ä»…ä»…æ˜¯èŠå¤©æœºå™¨äººï¼Œè€Œæ˜¯ä¸€ä¸ªçœŸæ­£çš„ AI åŠ©æ‰‹ã€‚**

---

## åŠŸèƒ½ç‰¹æ€§

| åŠŸèƒ½ | è¯´æ˜ | çŠ¶æ€ |
|------|------|:----:|
| æ–‡å­—èŠå¤© | ä¸ AI Agent åŒå‘æ–‡å­—å¯¹è¯ | âœ… |
| å›¾ç‰‡å‘é€ | AI å¯ä»¥å‘é€å›¾ç‰‡ï¼ˆç”Ÿæˆçš„å›¾è¡¨ã€æˆªå›¾ç­‰ï¼‰ | âœ… |
| å›¾ç‰‡ç†è§£ | ç”¨æˆ·å‘å›¾ç‰‡ï¼ŒAI èƒ½è¯†åˆ«å¹¶ç†è§£ | âœ… |
| æ–‡ä»¶å‘é€ | AI å¯ä»¥å‘é€ PDFã€TXTã€DOCX ç­‰æ–‡ä»¶ | âœ… |
| è¯­éŸ³æ¶ˆæ¯ | æ”¯æŒè¯­éŸ³æ¶ˆæ¯æ®µå‘é€ | âœ… |
| è§†é¢‘æ¶ˆæ¯ | æ”¯æŒè§†é¢‘æ¶ˆæ¯æ®µå‘é€ | âœ… |
| ç¾¤èŠæ”¯æŒ | æ”¯æŒç§èŠå’Œç¾¤èŠä¸¤ç§æ¨¡å¼ | âœ… |
| ä¸»åŠ¨æ¨é€ | ç»•è¿‡ Agentï¼Œç›´æ¥é€šè¿‡ API å‘é€æ¶ˆæ¯ | âœ… |
| å®šæ—¶ä»»åŠ¡ | åŸºäº crontab çš„å®šæ—¶æ¶ˆæ¯å‘é€ | âœ… |
| éšæœºé—®å€™ | æ¯å¤©éšæœºæ—¶é—´å‘é€é—®å€™ï¼Œæ¨¡æ‹ŸçœŸäºº | âœ… |
| æœåŠ¡å™¨å‘Šè­¦ | ç«¯å£ç›‘æ§ã€ç£ç›˜/å†…å­˜å‘Šè­¦è‡ªåŠ¨é€šçŸ¥ | âœ… |
| å®Œæ•´ OneBot API | å°è£…äº† OneBot v11 å…¨éƒ¨ API | âœ… |

---

## é¡¹ç›®ç»“æ„

```
openclaw-qq-plugin/
â”œâ”€â”€ plugin/                      # QQ Channel æ’ä»¶ï¼ˆæ ¸å¿ƒï¼‰
â”‚   â”œâ”€â”€ index.ts                 # æ’ä»¶å…¥å£ï¼Œæ³¨å†Œ channel
â”‚   â”œâ”€â”€ package.json             # æ’ä»¶ä¾èµ–
â”‚   â”œâ”€â”€ openclaw.plugin.json     # OpenClaw æ’ä»¶æ¸…å•
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ channel.ts           # æ ¸å¿ƒé€»è¾‘ï¼šæ¶ˆæ¯æ”¶å‘ã€åª’ä½“æ£€æµ‹ã€æ–‡ä»¶æœåŠ¡å™¨
â”‚       â”œâ”€â”€ client.ts            # OneBot v11 WebSocket å®¢æˆ·ç«¯ï¼ˆå®Œæ•´ APIï¼‰
â”‚       â”œâ”€â”€ config.ts            # é…ç½® Schemaï¼ˆZodï¼‰
â”‚       â”œâ”€â”€ file-server.ts       # HTTP æ–‡ä»¶æœåŠ¡å™¨
â”‚       â”œâ”€â”€ runtime.ts           # PluginRuntime ç®¡ç†
â”‚       â””â”€â”€ types.ts             # OneBot v11 å®Œæ•´ç±»å‹å®šä¹‰
â”œâ”€â”€ tools/                       # å·¥å…·è„šæœ¬é›†
â”‚   â”œâ”€â”€ send-message.js          # ä¸»åŠ¨å‘é€ QQ æ¶ˆæ¯
â”‚   â”œâ”€â”€ simple-cron.js           # å®šæ—¶ä»»åŠ¡ç®¡ç†ï¼ˆcrontabï¼‰
â”‚   â”œâ”€â”€ random-greetings.js      # éšæœºé—®å€™ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ event-monitor.js         # æœåŠ¡å™¨äº‹ä»¶ç›‘å¬ä¸å‘Šè­¦
â”‚   â”œâ”€â”€ cron-helper.js           # OpenClaw Cron API ç®¡ç†
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ systemd/
â”‚   â””â”€â”€ qq-event-monitor.service # äº‹ä»¶ç›‘å¬ systemd æœåŠ¡
â”œâ”€â”€ config-example/
â”‚   â””â”€â”€ openclaw.json            # OpenClaw é…ç½®ç¤ºä¾‹
â”œâ”€â”€ README.md
â”œâ”€â”€ LICENSE
â””â”€â”€ .gitignore
```

---

## æ¶æ„è¯´æ˜

![image-20260206194430728](img\image-20260206194430728.png)

**æ¶ˆæ¯æµç¨‹ï¼š**

1. ç”¨æˆ·åœ¨ QQ å‘é€æ¶ˆæ¯
2. NapCat é€šè¿‡ WebSocket æ¨é€äº‹ä»¶åˆ° QQ Plugin
3. Plugin æ„å»ºä¸Šä¸‹æ–‡ â†’ è®°å½•ä¼šè¯ â†’ è°ƒç”¨ Agent
4. Agent ç”Ÿæˆå›å¤ï¼ˆå¯èƒ½åŒ…å«æ–‡æœ¬ã€å›¾ç‰‡ã€æ–‡ä»¶ï¼‰
5. Plugin é€šè¿‡ `deliver()` å›è°ƒå°†å›å¤å‘é€å› QQ

---

## å¿«é€Ÿå¼€å§‹

### å‰ç½®æ¡ä»¶

- [OpenClaw](https://github.com/openclaw/openclaw) å·²å®‰è£…å¹¶è¿è¡Œï¼ˆNode.js 22+ï¼‰
- [NapCat](https://github.com/NapCatQQ/NapCat-Docker) å·²å®‰è£…å¹¶è¿è¡Œï¼ˆæ¨è Dockerï¼‰
- QQ ä¸ªäººå·å·²ç™»å½• NapCat
- NapCat å·²å¼€å¯**æ­£å‘ WebSocket æœåŠ¡**ï¼ˆé»˜è®¤ç«¯å£ 3001ï¼‰

### ç¬¬ä¸€æ­¥ï¼šå®‰è£…æ’ä»¶

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/YOUR_USERNAME/openclaw-qq-plugin.git

# å°† plugin ç›®å½•å¤åˆ¶åˆ° OpenClaw extensions
cp -r openclaw-qq-plugin/plugin ~/.openclaw/extensions/qq

# å®‰è£…ä¾èµ–
cd ~/.openclaw/extensions/qq
npm install --omit=dev
```

### ç¬¬äºŒæ­¥ï¼šé…ç½® OpenClaw

ç¼–è¾‘ `~/.openclaw/openclaw.json`ï¼Œæ·»åŠ  QQ æ’ä»¶é…ç½®ï¼š

```json
{
  "plugins": {
    "entries": {
      "qq": { "enabled": true }
    }
  },
  "channels": {
    "qq": {
      "enabled": true,
      "wsUrl": "ws://127.0.0.1:3001",
      "accessToken": "your_napcat_token"
    }
  }
}
```

> å®Œæ•´é…ç½®ç¤ºä¾‹è§ [config-example/openclaw.json](config-example/openclaw.json)

### ç¬¬ä¸‰æ­¥ï¼šä¿®æ”¹å…³é”®å‚æ•°

**å¿…é¡»ä¿®æ”¹çš„åœ°æ–¹**ï¼ˆæœç´¢ `TODO` å³å¯æ‰¾åˆ°ï¼‰ï¼š

| æ–‡ä»¶ | å‚æ•° | è¯´æ˜ |
|------|------|------|
| `plugin/src/channel.ts` | `FILE_SERVER_BASE_URL` | Docker ç½‘æ¡¥ IPï¼ˆè§ä¸‹æ–¹è¯´æ˜ï¼‰ |
| `tools/send-message.js` | `ACCESS_TOKEN` | NapCat çš„ access token |
| `tools/*.js` | `QQ_USER` | ä½ çš„ QQ å· |
| `tools/cron-helper.js` | `GATEWAY_TOKEN` | OpenClaw Gateway token |

**è·å– Docker ç½‘æ¡¥ IPï¼š**

```bash
ip addr show docker0 | grep inet
# è¾“å‡ºç±»ä¼¼ï¼šinet 172.17.0.1/16 â†’ ä½¿ç”¨ 172.17.0.1
```

> å¦‚æœ NapCat ä¸æ˜¯ Docker éƒ¨ç½²ï¼Œç›´æ¥ç”¨ `127.0.0.1` å³å¯ã€‚

### ç¬¬å››æ­¥ï¼šé‡å¯ OpenClaw

```bash
# é‡å¯ Gateway
openclaw gateway restart

# éªŒè¯æ’ä»¶åŠ è½½
openclaw channels status
```

åœ¨ QQ ä¸Šç»™æœºå™¨äººå‘ä¸€æ¡æ¶ˆæ¯ï¼Œå¦‚æœæ”¶åˆ°å›å¤ï¼Œè¯´æ˜ä¸€åˆ‡æ­£å¸¸ï¼

---

## å·¥å…·è„šæœ¬

å·¥å…·è„šæœ¬ä½äº `tools/` ç›®å½•ï¼Œæä¾›ä¸»åŠ¨å‘é€ã€å®šæ—¶ä»»åŠ¡ç­‰æ‰©å±•åŠŸèƒ½ã€‚

### å®‰è£…

```bash
cd tools/
npm install
```

### ä¸»åŠ¨å‘é€æ¶ˆæ¯

```bash
# å‘é€ç§èŠæ¶ˆæ¯
node tools/send-message.js <QQå·> "ä½ å¥½ï¼Œè¿™æ˜¯ä¸€æ¡ä¸»åŠ¨æ¶ˆæ¯"

# å‘é€ç¾¤æ¶ˆæ¯
node tools/send-message.js group:<ç¾¤å·> "è¿™æ˜¯ä¸€æ¡ç¾¤æ¶ˆæ¯"
```

### å®šæ—¶ä»»åŠ¡

```bash
# æ¯å¤©æ—©ä¸Š 8:00 å‘é€é—®å€™
node tools/simple-cron.js add-daily 8 0 "æ—©ä¸Šå¥½ï¼æ–°çš„ä¸€å¤©å¼€å§‹äº†"

# æŸ¥çœ‹æ‰€æœ‰å®šæ—¶ä»»åŠ¡
node tools/simple-cron.js list

# ä¸€é”®åˆ›å»ºç¤ºä¾‹ä»»åŠ¡ï¼ˆæ—©å®‰ã€åˆé¤ã€æ™šå®‰ï¼‰
node tools/simple-cron.js examples
```

### éšæœºé—®å€™ï¼ˆæ¨¡æ‹ŸçœŸäººï¼‰

æ¯å¤©ç”Ÿæˆ 15-25 ä¸ªéšæœºæ—¶é—´ç‚¹ï¼Œå‘é€ä¸åŒçš„é—®å€™è¯­ï¼š

```bash
# ç”Ÿæˆä»Šå¤©çš„éšæœºé—®å€™ä»»åŠ¡
node tools/random-greetings.js generate

# é¢„è§ˆéšæœºæ—¶é—´ç‚¹
node tools/random-greetings.js preview

# æµ‹è¯•å‘é€ä¸€æ¡
node tools/random-greetings.js test
```

æ¯å¤©è‡ªåŠ¨åˆ·æ–°ï¼š

```bash
# æ·»åŠ åˆ° crontabï¼Œæ¯å¤©å‡Œæ™¨ 0:05 è‡ªåŠ¨é‡æ–°ç”Ÿæˆ
(crontab -l 2>/dev/null; echo "5 0 * * * node /root/qq-tools/random-greetings.js generate") | crontab -
```

### æœåŠ¡å™¨äº‹ä»¶ç›‘å¬

ç›‘æ§ç«¯å£è®¿é—®ã€ç£ç›˜ç©ºé—´ã€å†…å­˜ä½¿ç”¨ï¼Œå¼‚å¸¸æ—¶è‡ªåŠ¨é€šè¿‡ QQ å‘Šè­¦ï¼š

```bash
# å‰å°è¿è¡Œ
node tools/event-monitor.js

# éƒ¨ç½²ä¸º systemd æœåŠ¡ï¼ˆæ¨èï¼‰
sudo cp systemd/qq-event-monitor.service /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl enable --now qq-event-monitor.service
```

---

## å¸¸è§é—®é¢˜

<details>
<summary><b>NapCat æ— æ³•è®¿é—®æ–‡ä»¶æœåŠ¡å™¨ï¼ˆæ–‡ä»¶/å›¾ç‰‡å‘é€å¤±è´¥ï¼‰</b></summary>

NapCat åœ¨ Docker å®¹å™¨ä¸­æ—¶ï¼Œ`127.0.0.1` æŒ‡å‘å®¹å™¨è‡ªèº«ã€‚éœ€è¦ä½¿ç”¨å®¿ä¸»æœºçš„ Docker ç½‘æ¡¥ IPï¼š

```bash
ip addr show docker0 | grep inet
# è¾“å‡ºï¼šinet 172.17.0.1/16
```

ä¿®æ”¹ `plugin/src/channel.ts` ä¸­çš„ `FILE_SERVER_BASE_URL` ä¸º `http://172.17.0.1:18790`ã€‚

</details>

<details>
<summary><b>æ–‡ä»¶å‘é€æŠ¥ Invalid URL</b></summary>

ä¸è¦å¯¹æ–‡ä»¶è·¯å¾„ä½¿ç”¨ `encodeURIComponent()`ï¼Œå¦åˆ™ `/` ä¼šè¢«ç¼–ç ä¸º `%2F`ã€‚ä»£ç ä¸­å·²æ­£ç¡®å¤„ç†ï¼Œç›´æ¥æ‹¼æ¥è·¯å¾„å³å¯ã€‚

</details>

<details>
<summary><b>ç”¨æˆ·å‘å›¾ç‰‡å AI å›å¤"æ²¡æ”¶åˆ°æ–‡æœ¬"</b></summary>

å·²åœ¨ä»£ç ä¸­å¤„ç†ï¼šå½“æ¶ˆæ¯åªåŒ…å«å›¾ç‰‡/æ–‡ä»¶ç­‰åª’ä½“æ—¶ï¼Œè‡ªåŠ¨æ·»åŠ  `[å›¾ç‰‡]`ã€`[æ–‡ä»¶]` ç­‰æè¿°æ€§æ–‡æœ¬ã€‚

</details>

<details>
<summary><b>AI å‘é€æ–‡ä»¶åå¤šäº†ä¸€æ¡å¥‡æ€ªçš„å›å¤</b></summary>

NapCat å‘é€æ–‡ä»¶åä¼šäº§ç”Ÿç©ºçš„æ¶ˆæ¯å›æ‰§äº‹ä»¶ã€‚å·²åœ¨ä»£ç ä¸­è¿‡æ»¤ç©ºæ¶ˆæ¯ã€‚

</details>

<details>
<summary><b>TypeScript æŠ¥é”™ "Cannot find module 'openclaw/plugin-sdk'"</b></summary>

è¿™æ˜¯æ­£å¸¸çš„ã€‚`openclaw/plugin-sdk` æ˜¯ OpenClaw åœ¨è¿è¡Œæ—¶é€šè¿‡ `jiti` åŠ¨æ€è§£æçš„åˆ«åï¼Œä¸éœ€è¦å•ç‹¬å®‰è£…ã€‚æ’ä»¶åœ¨ OpenClaw ç¯å¢ƒä¸­è¿è¡Œæ—¶ä¼šè‡ªåŠ¨è§£æã€‚

</details>

<details>
<summary><b>å¦‚ä½•æŸ¥çœ‹æ’ä»¶æ—¥å¿—ï¼Ÿ</b></summary>

æ’ä»¶æ—¥å¿—è¾“å‡ºåˆ° OpenClaw Gateway çš„æ ‡å‡†è¾“å‡ºï¼Œä»¥ `[QQ]` å‰ç¼€æ ‡è¯†ï¼š

```bash
# å¦‚æœç”¨ systemd
journalctl -u openclaw -f | grep "\[QQ\]"

# å¦‚æœå‰å°è¿è¡Œ
# æ—¥å¿—ç›´æ¥æ˜¾ç¤ºåœ¨ç»ˆç«¯
```

</details>

---

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºä½ çš„åŠŸèƒ½åˆ†æ”¯ï¼š`git checkout -b feature/amazing-feature`
3. æäº¤æ›´æ”¹ï¼š`git commit -m 'Add amazing feature'`
4. æ¨é€åˆ°åˆ†æ”¯ï¼š`git push origin feature/amazing-feature`
5. æäº¤ Pull Request

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT License](LICENSE) å¼€æºã€‚

---

## ğŸ™ è‡´è°¢

- [OpenClaw](https://github.com/openclaw/openclaw) â€” å¼ºå¤§çš„ AI Agent æ¡†æ¶
- [NapCat](https://github.com/NapCatQQ/NapCat-Docker) â€” ç°ä»£åŒ–çš„ QQ OneBot å®ç°
- [OneBot v11](https://github.com/botuniverse/onebot-11) â€” ç»Ÿä¸€çš„èŠå¤©æœºå™¨äºº API æ ‡å‡†

---

<a name="english"></a>

## English

### What is this?

This is a QQ channel plugin for [OpenClaw](https://github.com/openclaw/openclaw) that connects your AI Agent to QQ (a popular Chinese messaging platform) via the [OneBot v11](https://github.com/botuniverse/onebot-11) protocol.

### Features

- **Full chat support** â€” Text, images, files, audio, video messaging
- **Image understanding** â€” AI can understand images sent by users
- **Proactive messaging** â€” Send messages without waiting for user input
- **Scheduled tasks** â€” Cron-based scheduled messages
- **Random greetings** â€” Human-like random greeting times
- **Server monitoring** â€” Port, disk, memory alerts via QQ

### Quick Start

1. Install [OpenClaw](https://github.com/openclaw/openclaw) and [NapCat](https://github.com/NapCatQQ/NapCat-Docker)
2. Clone this repo and copy `plugin/` to `~/.openclaw/extensions/qq/`
3. Run `npm install --omit=dev` in the plugin directory
4. Add QQ channel config to `~/.openclaw/openclaw.json`:

```json
{
  "plugins": { "entries": { "qq": { "enabled": true } } },
  "channels": {
    "qq": {
      "enabled": true,
      "wsUrl": "ws://127.0.0.1:3001",
      "accessToken": "your_token"
    }
  }
}
```

5. Restart OpenClaw Gateway
6. Send a message to your QQ bot!

### Configuration

Search for `TODO` in the source files to find all configurable parameters:

- `FILE_SERVER_BASE_URL` in `plugin/src/channel.ts` â€” Docker bridge IP for file server
- `ACCESS_TOKEN` in `tools/send-message.js` â€” NapCat WebSocket token
- `QQ_USER` in `tools/*.js` â€” Your QQ number

### License

[MIT](LICENSE)
